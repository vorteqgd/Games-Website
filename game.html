<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>67 Games</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="game.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <div class="nav">
        <script src="nav.js"></script>
        <script>createNav()</script>
    </div>
    <div class="main" x-data="app()" x-init="loadData()">

        <!-- game -->
        <div class="game-box">
            <iframe :src="game.embed ? game.embed : `embed/${game.id}`" frameborder="0" class="game-ifr"></iframe>

            <!-- title -->
            <div class="info-box">
                <h1 x-text="game.title"></h1>
                <a :href="`/fs?id=${game.id}`" class="button"><i class="fa-solid fa-expand icon"></i>Fullscreen</a>
            </div>

            <!-- tags -->
            <template x-if="game.tags && game.tags.length">
                <div class="tags-box">
                    <template x-for="tag in game.tags" :key="tag">
                        <a class="tag" :href="`tag?t=${tag}`" x-text="tag"></a>
                    </template>
                </div>
            </template>
            <hr>

            <!-- description -->
            <div class="description-box">
                <p x-text="game.description"></p>
                <template x-if="game.author">
                    <p><b>Author: </b><span x-text="game.author"></span></p>
                </template>
                <template x-if="game.version">
                    <p><b>Version: </b><span x-text="game.version"></span></p>
                </template>
            </div>
        </div>

        <!-- suggested games -->
        <div class="suggested-box">
            <template x-for="game in games" :key="game.id">
                <div class="game" :style="`background-image: url(${game.thumbnail})`">
                    <a :href="`game?id=${game.id}`" class="game-title" x-text="game.title"></a>
                </div>
            </template>
        </div>
    </div>

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const idParam = params.get('id');
        function app() {
            return {
                game: {},
                games: [],

                async loadData() {
                    const [gamesRes, gameRes] = await Promise.all([
                        fetch("/server/popular"),
                        fetch("/server/game/" + idParam)
                    ]);
                    const data = await gameRes.json();
                    this.games = await gamesRes.json();
                    this.game = data;
                    document.title = this.game.title + " - 67 Games";
                }
            }
        }
    </script>
</body>

</html>